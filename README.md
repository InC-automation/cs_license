# Описание

Это демонстрационный пример реализации функции чтения данных о лицензии коммуникационного сервера Эликонт-КС.
Приложение читает данные и отправляет их в канал User channel Эликонт-КС в виде набора сигналов. Далее сигналы могут быть переданы в смежную систему по одному из коммуникационных протоколов.

Данный пример предназначен для использования на стендах и учебных полигонах с целью изучения возможностей расширения Эликонт-КС. Автор не несет ответственности за негативные последствия, вызванные использованием данного примера.

Пример разработан на языке Python.

Для начала работы нужно установить Эликонт-КС. Скачать дистрибутив для нужной ОС можно по ссылке: https://ptk-sura.ru/products/kommunikatsionnyy-server/elicont-cs/

Там же есть инструкции по установке и настройке.

>Для использования примера необходима версия Эликонт-КС не ниже 2.8.

# Процедура установки и настройки
1. На странице https://www.python.org/downloads/windows/ скачать инсталлятор Python и установить его.
>На момент разработки примера актуальной является версия python-3.13.7.exe

2. Установить библиотеку для работы с gRPC

Выполнить в командной строке: 
`pip install grpcio grpcio-tools`

Если Интернет доступен через прокси, то надо использовать команду:

`pip install grpcio grpcio-tools --proxy //[user:passwd@]proxy.server:port`

4. Создать в каталог для приложения. Поместить туда файлы:

* elecont.proto - файл с описанием интерфейсов gRCP;
* cs_license.py - стартовый файл для запуска обмена данными (на языке Python);
* license.py - файл, в котором реализован класс для работы с лицензией Эликонт-КС (на языке Python);
* settings.ini - файл с настройками приложения

5. Создать файлы для работы с gRPC (на языке Python).
> Этот шаг можно пропустить, т.к. файлы для Python уже приложены к примеру.

В каталоге с приложением выполнить в командной строке:

`>python -m grpc_tools.protoc --python_out=%CD% --grpc_python_out=%CD% --proto_path=%CD% *.proto`

Должны появиться файлы:
* elecont_pb2.py
* elecont_pb2_grpc.py

6. В Конфигураторе Эликонт-КС открыть проект license_info.elconf и загрузить его в КС.
>См. руководство пользователя Эликонт-КС.

7. В файле settings.ini поменять настройки, если необходимо:

Параметр | Назначение
------------------------|------------------------
USERCHANNEL = localhost:29041 | подключение к КС
APIGATEWAY = localhost:8080 | имя сервера OPC DA
CYCLE_PERIOD = 5 | период цикла чтения информации о лицензии (сек)
CONNECT_PERIOD = 30 | период подключения к серверам КС и OPC DA (сек)
TRACE = 0	| режим логирования (0 - ограниченный, 1 - расширенный)
TIME_DELTA = 0 | сдвиг метки времени в часах (для учета часового пояса)
8. Запустить скрипт.

Выполнить в командной строке:

`python cs_license.py`

9. Проконтролировать обновление сигналов в Конфигураторе
>См. руководство пользователя Эликонт-КС.

10. Подключиться к КС с помощью OPC UA Expert. Проконтролировать обновление сигналов.
>Дистрибутив OPC UA Expert доступен по ссылке: https://www.unified-automation.com/downloads/opc-ua-clients.html

11. Ввести значения команды с помощью OPC UA Expert. Проконтролировать изменение соответствующего сигнала.

## Исполняемый файл
Если на целевой машине отсутствует интерпретатор Python, и его установка нежелательна, то нужно подготовить исполняемый файл программы.

1. Установить библиотеку для компиляции:
Выполнить в командной строке:
>pip install pyinstaller
2. Перейти в каталог со скриптом и выполнить команду:
>pyinstaller --onefile --hidden-import win32timezone cs_license.py

В результате компиляции получится файл /dist/cs_license.exe

3. В каталог с исполняемым файлом нужно скопировать файл с настройками (settings.ini).
4. Можно запускать файл на выполнение.